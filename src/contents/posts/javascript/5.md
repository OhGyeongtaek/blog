---
slug: "5"
date: "2022.02.28"
title: "[Javascript] Event Loop"
description: "Event Loop에 대해 이해하고 Call Stack, Task Queue, Heap에 대해 이해할 수 있다."
category: "Javascript"
---

# Event Loop란?

자바스크립트는 <b>싱글스레드</b>언어입니다.
하지만 자바스크립트로 코드를 작성하다 보면 한나의 태스크만 처리하는 것이 아닌 많은 태스크를 동시에 처리하는것 처럼 느껴집니다.
그럼 이제 자바스크립트는 싱글스레드 언어인데 어떻게 많은 태스크를 동시에 처리하는것 처럼 느껴지는지에 대해 알아보겠습니다.

# Javascript Engine

이벤트 루프를 알아보기 전에 자바스크립트 엔진을 구성하는 3가지 영역에 대해 알아보겠습니다.

## Call Stack

자바스크립트는 단 하나의 콜스택만 사용을 합니다.
하나의 함수가 실행되면 이 함수 실행이 끝날 때까지 다른 어떤 태스크도 수행될 수 없다는 의미를 갖습니다.
실행한 함수 내부에서 다른 함수를 실행할 경우 순차적으로 콜스택에 해당 함수가 생성되고, 해당 함수가 종료되면 콜스택에서도 제거됩니다.

## Callback Queue

자바스크립트는 비동기 함수를 만났을 때 <b>Web API</b>라는 공간에 프레임을 생성하게 됩니다.
Web API에서 해당 함수가 실행될 준비가 됬다면, Callback Queue에 함수를 생성하고 Web API에서는 제거되게 됩니다.
Callback Queue에서는 Call Stack의 태스크가 끝날때 까지 기다린 뒤 탸스크가 끝나면 Callback Queue에 들어온 순서대로 태스크를 실행하게 됩니다.
이 부분에 대해서는 아래에서 추가 설명 하겠습니다.

## Heap

참조값을 갖는 객체, 함수, 배열이 힙에 저장됩니다.

<figure>
    <img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkF7gU%2Fbtq1Xlwhaaz%2FMAR4LAk3Tbj254Lp0fZK9k%2Fimg.png" alt="자바스크립트 메모리 구조: 콜스택, 메모리 힙" title="자바스크립트 메모리 구조: 콜스택, 메모리 힙"/>
    <figcaption>
        <a href="https://curryyou.tistory.com/276">자바스크립트 메모리 구조: 콜스택, 메모리 힙 - 카레유</a>
    </figcaption>
</figure>

배열, 객체, 함수를 선언했을 때 콜스택 상의 렉시컬 환경에 해당 인스턴스의 참조값이 저장이 되고, 힙 영역에는 해당 인스턴스가 생성 됩니다.

# 이벤트 루프 동작 방식

![이벤트 루프 동작 방식](https://user-images.githubusercontent.com/20200820/155964887-2e1db2db-b62a-4d7c-991e-4c5a0f6174e0.png)

자바스크립트에서 함수가 실행되면 콜스택에 함수스택이 쌓입니다.
함수 로직을 실행하다가 비동기 함수를 만나면 Web API에 전달 후 뒤의 로직을 실행합니다.
함수가 끝나면 콜스택에서 해당 함수는 지워지게 됩니다.
Web API에서 전달된 콜백함수가 실행 준비가 완료가되면 콜백큐에 전달하게 됩니다.
콜백큐에 전달된 함수는 콜스택이 비게되면 콜백큐에 가장 먼저 들어온 태스크를 콜스택에 전달하여 실행하게 됩니다.
